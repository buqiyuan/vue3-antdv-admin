import{r as m,c as B,dr as c,e as l,e8 as K,B as X,d as Y,aC as Z,w as ee,o as ae,C as S,v as d,F as i,H as n,J as te,q as $,ag as ne,L as E,cO as le,K as H,N as oe,T as se,at as I}from"./index-Clv9zNM3.js";import{_ as ie,g as re}from"./file-operate-button-list.vue_vue_type_script_setup_true_lang-BB__F0rZ.js";import{_ as me}from"./file-preview-drawer.vue_vue_type_script_setup_true_lang-bipHid-Y.js";import{f as ue,p as pe}from"./index-jwD5cS8J.js";import{f as ce}from"./dateUtil-C_wTM_e-.js";import"./index.vue_vue_type_style_index_0_lang-CFCPI4h7.js";import{u as fe}from"./useFormModal-B6odna7M.js";import{c as de}from"./createContextMenu-Cp8ZSViy.js";import{u as ve}from"./dynamic-table-ewKYMhCK.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DvgRuKxQ.js";import"./dayjs.min-BYaCBWoX.js";import{b as F}from"./index-D-la6T6i.js";import{S as U}from"./index-ly56m3IY.js";import{F as ge}from"./index-DXPG-Hl7.js";import{B as N}from"./index-5LxABlvE.js";import{C as he}from"./index-Kl1M3oNd.js";import"./file-upload-drawer.vue_vue_type_script_setup_true_lang-DOx7MkEm.js";import"./index-6s4yWWsS.js";import"./isNumeric-DjvBa-1E.js";import"./index-6_t5xb7Y.js";import"./index-CsLYSjjd.js";import"./cloneDeep-s5SpPfgx.js";import"./useFlexGapSupport-FJ5YreuO.js";import"./hasIn-DoY5MSeO.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./debounce-BtYDntiA.js";import"./QuestionCircleOutlined-B99GTLc_.js";import"./collapseMotion-BCa41I5P.js";import"./_castArrayLikeObject-BIyyQ4IM.js";import"./index-C2Yf5-vJ.js";import"./CheckOutlined-C_x0bhih.js";import"./useRefs-CCU70ahe.js";import"./useMergedState-CVClCPu2.js";import"./index-C6XAppnf.js";import"./index-BJ4r8mM4.js";import"./_baseUniq-CsQ8HEXR.js";import"./move-DRIeMv9s.js";import"./RightOutlined-CtKcSETS.js";import"./CopyOutlined-DN6DmnBM.js";import"./index-CxEAG5-f.js";import"./isNumber-s4abpS_O.js";import"./LeftOutlined-DkJ_dKcN.js";import"./index-Cze_hPY3.js";import"./is-fQYYZi7x.js";import"./FullscreenOutlined-DgQLmHrK.js";import"./useModal-BtfKNujp.js";import"./schema-form.vue_vue_type_script_setup_true_lang-uF5z2XZj.js";import"./index-Binr3P75.js";import"./DownOutlined-DxS2-6Ij.js";import"./pick-DtFW9KKp.js";import"./VerticalRightOutlined-DF3cgokL.js";import"./zh_CN-CAyhejr6.js";import"./index-D0onqgqk.js";import"./index-BPPLYRCV.js";import"./isMobile-BbN7I0i_.js";import"./index-CYmqXHpm.js";import"./EnterOutlined-Bw7wTOJA.js";import"./index-DrW2oiMG.js";import"./PlusOutlined-8cnECNsV.js";const ye=p=>p?ue(p):"-",ke=()=>{const p=m([]),v=m(""),k=B(()=>!c(v.value)),T=B(()=>[{title:"文件名",dataIndex:"name",align:"left"},{title:"大小",width:120,align:"center",dataIndex:"fsize",customRender:({record:a})=>l("span",null,[ye(a.fsize)])},{title:"上传时间",dataIndex:"putTime",align:"center",width:220,customRender({text:a}){return a?ce(a):"-"}},{title:"所属目录",dataIndex:"belongTo",align:"center",width:220,hideInTable:!k.value,customRender:({record:a})=>l(X("a-button"),{type:"link",disabled:a.type==="file"&&K("netdisk:manage:info"),onClick:()=>C(a)},{default:()=>[a.belongTo?a.belongTo:"根目录"]})}]),C=a=>{v.value="",c(a.belongTo)?p.value=[]:p.value=a.belongTo.split("/")};return{columns:T,currentPathList:p,localSearchKey:v,isSearching:k}},_e=["innerHTML"],be={key:1},La=Y({name:"NetDiskManage",__name:"manage",setup(p){const[v,k]=ve(),[T]=fe(),{columns:C,currentPathList:a,localSearchKey:u,isSearching:_}=ke(),w=m(),g=m([]),h=m(""),P=m(!1),D=m(!1),x=m(!1),f=m(!1),M=m([]),O=Z({selectedRowKeys:[],onChange:(e,t)=>{O.selectedRowKeys=e,M.value=t.map(r=>({type:r.type,name:r.name}))}}),V=B(()=>c(h.value)),y=()=>{let e="";return a.value.length>0&&(e=`${a.value.join("/")}/`),e},J=(e,t)=>t==="dir"?"file-type-dir":pe(e),j=e=>e.replace(new RegExp(`${u.value}`,"g"),`<span style='color: red;'>${u.value}</span>`),q=e=>{P.value!==e&&(P.value=e)},L=()=>{h.value=" ",g.value=[],M.value=[],f.value&&(f.value=!1),R()},R=async()=>{var r;if(f.value,f.value)return;D.value=!0,f.value=!0;const e=y(),t=await I.netDiskManage.netDiskManageList({path:e,key:u.value,marker:((r=h.value)==null?void 0:r.trim())||""}).finally(()=>D.value=!1);if(c(h))g.value=t.list||[];else{const o=t.list.filter(s=>s.type==="file"?!0:!g.value.find(b=>b.type==="file"?!1:b.name===s.name));c(o)||g.value.push(...o)}h.value=t.marker,f.value=!1},z=e=>{_.value||(e===-1&&a.value.length>0?a.value=[]:e>=0&&a.value.length-1!==e&&(a.value=a.value.slice(0,e+1)))},A=e=>{var t,r;if(e.type==="dir")if(_.value){const o=c(e.belongTo)?[]:e.belongTo.split("/");o.push(e.name),u.value="",a.value=o}else a.value.push(e.name);else _.value?(t=w.value)==null||t.open(e.name,c(e.belongTo)?"":`${e.belongTo}/`):(r=w.value)==null||r.open(e.name,y())},W=async e=>{try{x.value=!0;const t=await I.netDiskManage.netDiskManageDownload({path:y(),name:e.name});window.open(`${t}?attname=${encodeURIComponent(e.name)}`)}finally{x.value=!1}},G=async e=>{await T({modalProps:{title:"重命名",width:700,onFinish:async t=>{await I.netDiskManage.netDiskManageRename({type:e.type,toName:t.toName,name:e.name,path:y()},{successMsg:"修改成功"}),L()}},formProps:{labelWidth:100,schemas:re(e)}})},Q=e=>({onContextmenu:t=>{de({event:t,items:[{label:"下载",disabled:e.type==="dir"||!K("netdisk:manage:download"),handler:()=>{W(e)}},{label:"重命名",disabled:!K("netdisk:manage:rename"),handler:()=>{G(e)}}]})}});return ee([a,u],()=>{L()},{deep:!0}),ae(()=>{R(),k.onInfiniteScroll(()=>{V.value||R()})}),(e,t)=>{const r=ne;return d(),S(n(he),{class:"h-full"},{title:i(()=>[l(n(U),null,{default:i(()=>[l(n(ge)),l(n(N),null,{default:i(()=>[l(n(N).Item,null,{default:i(()=>[l(n(F).Link,{onClick:t[0]||(t[0]=o=>z(-1))},{default:i(()=>t[2]||(t[2]=[H("根目录")])),_:1,__:[2]})]),_:1}),(d(!0),$(oe,null,se(n(a),(o,s)=>(d(),S(n(N).Item,{key:s},{default:i(()=>[l(n(F).Link,{onClick:b=>z(s)},{default:i(()=>[H(E(o),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),extra:i(()=>[l(ie,{"search-key":n(u),"onUpdate:searchKey":t[1]||(t[1]=o=>le(u)?u.value=o:null),"selected-file-list":M.value,"update-operate-status":q,"parse-path":y,onChanged:L},null,8,["search-key","selected-file-list"])]),default:i(()=>[l(n(v),{"data-source":g.value,columns:n(C),"custom-row":Q,"auto-height":!0,pagination:!1,search:!1,"show-tool-bar":!1,loading:D.value,"row-selection":O},{bodyCell:i(({column:o,record:s})=>[o.key==="name"?(d(),S(n(F).Link,{key:0,disabled:s.type==="file"&&e.$auth("netdisk:manage:info"),onClick:b=>A(s)},{default:i(()=>[l(n(U),null,{default:i(()=>[l(r,{name:J(s.name,s.type)},null,8,["name"]),n(_)?(d(),$("span",{key:0,innerHTML:j(s.name)},null,8,_e)):(d(),$("span",be,E(s.name),1))]),_:2},1024)]),_:2},1032,["disabled","onClick"])):te("",!0)]),_:1},8,["data-source","columns","loading","row-selection"]),l(me,{ref_key:"previewDrawerRef",ref:w},null,512)]),_:1})}}});export{La as default};
