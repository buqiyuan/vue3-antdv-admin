import{r as R,a as m,w as v}from"./dynamic-table-ewKYMhCK.js";import{d as F}from"./dateUtil-C_wTM_e-.js";import{d as C,r as g,H as w,n as E,q as b,v as I,y as $,x as N,z as j,a6 as U}from"./index-Clv9zNM3.js";import{w as B}from"./index-jwD5cS8J.js";import"./index.vue_vue_type_style_index_0_lang-CFCPI4h7.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DvgRuKxQ.js";import"./dayjs.min-BYaCBWoX.js";const T=C({name:"ImportExcel",props:{dateFormat:{type:String},timeZone:{type:Number,default:8}},emits:["success","error"],setup(r,{emit:s}){const o=g(null),u=g(!1);function p(e){if(!e||!e["!ref"])return[];const t=[],n=m.decode_range(e["!ref"]),h=n.s.r;for(let a=n.s.c;a<=n.e.c;++a){const i=e[m.encode_cell({c:a,r:h})];let d=`UNKNOWN ${a}`;i&&i.t&&(d=m.format_cell(i)),t.push(d)}return t}function c(e){const t=[],{dateFormat:n,timeZone:h}=r;for(const a of e.SheetNames){const i=e.Sheets[a],d=p(i);let k=m.sheet_to_json(i,{raw:!0,dateNF:n});k=k.map(f=>{for(const y in f)f[y]instanceof Date&&(h===8&&f[y].setSeconds(f[y].getSeconds()+43),n&&(f[y]=F(f[y]).format(n)));return f}),t.push({header:d,results:k,meta:{sheetName:a}})}return t}function l(e){u.value=!0;const{promise:t,resolve:n,reject:h}=Promise.withResolvers(),a=new FileReader;return a.onload=async i=>{try{const d=i.target&&i.target.result,k=R(d,{type:"array",cellDates:!0}),f=c(k);s("success",f),n("")}catch(d){h(d),s("error")}finally{u.value=!1}},a.readAsArrayBuffer(e),t}async function x(e){const t=w(o);t&&(t.value=""),await l(e)}function S(e){const t=e&&e.target.files,n=t&&t[0];n&&x(n)}function D(){const e=w(o);e&&e.click()}return{handleUpload:D,handleInputClick:S,inputRef:o}}});function A(r,s,o,u,p,c){return I(),b("div",null,[$(N("input",{ref:"inputRef",type:"file",accept:".xlsx, .xls",onChange:s[0]||(s[0]=(...l)=>r.handleInputClick&&r.handleInputClick(...l))},null,544),[[j,!1]]),N("div",{onClick:s[1]||(s[1]=(...l)=>r.handleUpload&&r.handleUpload(...l))},[U(r.$slots,"default")])])}const H=E(T,[["render",A]]),_="excel-list.xlsx";function O({data:r,header:s,filename:o=_,json2sheetOpts:u={},write2excelOpts:p={bookType:"xlsx"}}){let c=[...r];if(s){c.unshift(s);const S=Object.keys(s);c=c.map(D=>S.reduce((e,t)=>(e[t]=D[t],e),{})),u.skipHeader=!0}const l=m.json_to_sheet(c,u),x={SheetNames:[o],Sheets:{[o]:l}};v(x,o,p)}function P({data:r,header:s,filename:o=_,write2excelOpts:u={bookType:"xlsx"}}){const p=[...r];s&&p.unshift(s);const c=m.aoa_to_sheet(p),l={SheetNames:[o],Sheets:{[o]:c}};v(l,o,u)}B(H);export{P as a,O as j};
