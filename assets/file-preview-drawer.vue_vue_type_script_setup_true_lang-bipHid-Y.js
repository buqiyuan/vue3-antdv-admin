import{f as N}from"./index-jwD5cS8J.js";import{d as S,q as I,v as u,r as l,c as V,B as $,C as f,H as a,F as s,e as r,T as A,N as F,a8 as H,K as T,a_ as L,ac as P,at as _,e8 as E,O as U,L as j}from"./index-Clv9zNM3.js";import{f as q}from"./dateUtil-C_wTM_e-.js";import{S as x}from"./index-ly56m3IY.js";import{I as K}from"./index-CxEAG5-f.js";import{D as b}from"./index-Cze_hPY3.js";import{D as O}from"./index-6s4yWWsS.js";const W=["data","type"],G=S({name:"preview-resource",__name:"index",props:{url:{type:String},type:{type:String}},setup(c){return(D,d)=>(u(),I("object",{key:c.url,data:c.url,type:c.type,width:"100%",height:"100%"},null,8,W))}}),ae=S({name:"FilePreviewDrawer",__name:"file-preview-drawer",setup(c,{expose:D}){const d=new Map([["name","文件名"],["mimeType","文件类型"],["hash","文件Hash"],["md5","文件MD5"],["fsize","文件大小"],["putTime","上传时间"],["uploader","上传人员"]]),w=l(!1),g=l(!1),h=l(""),y=l(""),t=l({}),m=l(""),p=l(""),k=l(!1),C=V(()=>`${m.value}?imageView2/2/w/500/h/210`),z=async(o,n)=>{g.value=!0,h.value=o,y.value=n,await P();try{w.value=!0;const v={name:o,path:n},i=await _.netDiskManage.netDiskManageInfo(v);if(p.value=i.mark,Array.from(d.keys()).forEach(e=>{e==="fsize"?t.value.fsize=N(i[e]):t.value[e]=i[e]}),t.value.putTime=q(i.putTime),t.value.name=o,E("netdisk:manage:download")){const e=await _.netDiskManage.netDiskManageDownload(v);m.value=e}}catch{M()}finally{w.value=!1}},B=async()=>{try{k.value=!0,await _.netDiskManage.netDiskManageMark({name:h.value,path:y.value,mark:p.value}),U.success("已更新文件备注")}finally{k.value=!1}},M=()=>{h.value="",y.value="",m.value="",p.value="",t.value={},g.value=!1};return D({open:z}),(o,n)=>{const v=$("a-button");return u(),f(a(O),{title:"文件详情",width:500,visible:g.value,onClose:M},{default:s(()=>[r(a(L),{spinning:w.value,class:"preview-drawer-inner-box"},{default:s(()=>[r(a(x),{direction:"vertical"},{default:s(()=>{var i;return[(i=t.value.mimeType)!=null&&i.startsWith("image/")?(u(),f(a(K),{key:0,class:"w-full h-[210px]",src:C.value,preview:{src:m.value}},null,8,["src","preview"])):(u(),f(G,{key:1,class:"w-full h-[210px]",url:m.value,type:t.value.mimeType},null,8,["url","type"])),r(a(b),{bordered:"",column:1,size:"small"},{default:s(()=>[(u(!0),I(F,null,A(a(d).keys(),e=>(u(),f(a(b).Item,{key:e,label:a(d).get(e),"label-style":{whiteSpace:"nowrap"}},{default:s(()=>[T(j(t.value[e]),1)]),_:2},1032,["label"]))),128)),r(a(b).Item,{label:"文件备注","label-style":{whiteSpace:"nowrap"}},{default:s(()=>[r(a(x),{direction:"vertical",align:"end"},{default:s(()=>[r(a(H).TextArea,{value:p.value,"onUpdate:value":n[0]||(n[0]=e=>p.value=e),disabled:!o.$auth("netdisk:manage:mark"),placeholder:"请输入文件备注",maxlength:100,rows:4,"show-count":""},null,8,["value","disabled"]),r(v,{loading:k.value,disabled:!o.$auth("netdisk:manage:mark"),type:"primary",size:"mini",onClick:B},{default:s(()=>n[1]||(n[1]=[T("更新 ")])),_:1,__:[1]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{ae as _};
