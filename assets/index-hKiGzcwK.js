import{d as j,bG as O,ei as E,aF as F,ej as S,r as w,c as D,C as k,v as _,F as c,e as r,dU as G,a8 as z,$ as B,am as K,H as d,ek as T,el as L,q as M,a2 as U,N as H,T as W,a9 as Y,aH as Z,em as J,n as Q,Z as C,K as b,aY as X,at as y,dC as R,en as ee,e5 as te,B as oe,x as ne,aV as ae}from"./index-Clv9zNM3.js";import{f as se}from"./dateUtil-C_wTM_e-.js";import{T as h}from"./index-D0onqgqk.js";import{T as ie,_ as le}from"./index-DrW2oiMG.js";import"./index-CsLYSjjd.js";import{f as re,s as $}from"./common-Tev1tLzZ.js";import{u as pe}from"./dynamic-table-ewKYMhCK.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DvgRuKxQ.js";import"./dayjs.min-BYaCBWoX.js";import"./index.vue_vue_type_style_index_0_lang-CFCPI4h7.js";import{u as ue}from"./useFormModal-B6odna7M.js";import"./index-BJ4r8mM4.js";import"./_baseUniq-CsQ8HEXR.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-BCa41I5P.js";import"./useRefs-CCU70ahe.js";import"./pick-DtFW9KKp.js";import"./hasIn-DoY5MSeO.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-CVClCPu2.js";import"./PlusOutlined-8cnECNsV.js";import"./cloneDeep-s5SpPfgx.js";import"./useFlexGapSupport-FJ5YreuO.js";import"./debounce-BtYDntiA.js";import"./QuestionCircleOutlined-B99GTLc_.js";import"./_castArrayLikeObject-BIyyQ4IM.js";import"./index-C6XAppnf.js";import"./move-DRIeMv9s.js";import"./RightOutlined-CtKcSETS.js";import"./VerticalRightOutlined-DF3cgokL.js";import"./schema-form.vue_vue_type_script_setup_true_lang-uF5z2XZj.js";import"./is-fQYYZi7x.js";import"./isNumber-s4abpS_O.js";import"./index-Binr3P75.js";import"./DownOutlined-DxS2-6Ij.js";import"./index-jwD5cS8J.js";import"./FullscreenOutlined-DgQLmHrK.js";import"./index-ly56m3IY.js";import"./LeftOutlined-DkJ_dKcN.js";import"./zh_CN-CAyhejr6.js";import"./index-DXPG-Hl7.js";import"./index-D-la6T6i.js";import"./EnterOutlined-Bw7wTOJA.js";import"./CheckOutlined-C_x0bhih.js";import"./CopyOutlined-DN6DmnBM.js";import"./index-6_t5xb7Y.js";import"./index-C2Yf5-vJ.js";import"./index-BPPLYRCV.js";import"./index-CYmqXHpm.js";import"./useModal-BtfKNujp.js";const ce=["title","onClick"],de=j({inheritAttrs:!1,__name:"IconPicker",props:O(J,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){E();const l=F(e,"value"),n=Object.entries(S).reduce((t,[s,i])=>(t[s]=Object.keys(i.icons).map(x=>({name:`${i.prefix}:${x}`})),t),{全部:Object.values(S).flatMap(t=>Object.keys(t.icons).map(s=>({name:`${t.prefix}:${s}`})))}),p=w(!1),a=w("全部"),m=w(""),v=D(()=>n[a.value].filter(s=>s.name.includes(m.value))),I=Y(t=>{m.value=t.target.value},100),o=t=>{l.value=t,p.value=!1};return(t,s)=>{const i=le,x=ie,P=z,q=G,N=Z;return _(),k(N,null,{default:c(()=>[r(q,{open:p.value,"onUpdate:open":s[2]||(s[2]=u=>p.value=u),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:c(()=>[r(x,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=u=>a.value=u),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:c(()=>[(_(!0),M(H,null,W(d(n),(u,g)=>(_(),k(i,{key:g,tab:g},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),r(P,{autofocus:"","allow-clear":"",placeholder:`从“${a.value}”中搜索图标`,onChange:d(I)},null,8,["placeholder","onChange"])]),content:c(()=>[r(d(L),{class:"select-box",items:v.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:c(({item:u})=>[(_(),M("div",{key:u.name,title:u.name,class:U([{active:l.value==u.name},"select-box-item"]),onClick:g=>o(u.name)},[r(d(T),{icon:u.name,class:"text-[20px]"},null,8,["icon"])],10,ce))]),_:1},8,["items"])]),default:c(()=>[r(P,B(t.$attrs,{value:l.value,"onUpdate:value":s[1]||(s[1]=u=>l.value=u),placeholder:t.placeholder,"allow-clear":""}),K({_:2},[l.value?{name:"prefix",fn:c(()=>[r(d(T),{icon:l.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),me=Q(de,[["__scopeId","data-v-7c9eece7"]]);function A(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!X(e)}const fe=e=>{switch(e){case 0:return r(h,{color:"warning"},{default:()=>[b("目录")]});case 1:return r(h,{color:"success"},{default:()=>[b("菜单")]});case 2:return r(h,{color:"error"},{default:()=>[b("权限")]});default:return""}},ye=[{title:"名称",dataIndex:"name",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"icon",hideInSearch:!0,customRender:({record:e})=>e.icon&&r(C,{icon:e.icon,size:"22"},null)},{title:"类型",width:80,dataIndex:"type",hideInSearch:!0,customRender:({record:e})=>fe(e.type)},{title:"节点路由",dataIndex:"path",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"component"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.permission&&r(h,{color:"processing"},{default:()=>[e.permission]})},{title:"排序",width:50,dataIndex:"orderNo",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.type===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"show",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.show===1,p=n?"green":"red",a=n?"显示":"隐藏";return r(h,{color:p},A(a)?a:{default:()=>[a]})}},{title:"状态",dataIndex:"status",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.status===1,p=n?"green":"red",a=n?"启用":"停用";return r(h,{color:p},A(a)?a:{default:()=>[a]})}},{title:"更新时间",width:180,dataIndex:"updatedAt",hideInSearch:!0,customRender({text:e}){return se(e)}}],be=e=>e===0,V=e=>e===1,f=e=>e===2,he=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"name",component:"Input",label:({formModel:e})=>f(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:l})=>{const n=await y.systemMenu.menuList({}),p=[-1].concat(re(n,l.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=p,[{id:-1,name:"根目录",children:n}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!f(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!be(e.type),required:({formModel:e})=>f(e.type),afterSlot:({schema:e,formInstance:l,formModel:n})=>e.value.component==="Input"?R(C,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const p=await y.systemMenu.menuGetPermissions();typeof n.permission=="string"&&(n.permission=n.permission.split(":")),l.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:a})=>a.join(":"),options:p.reduce((a,m)=>($(m,a,":"),a),[])}})}}):R(C,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(n.permission)&&(n.permission=n.permission.join(":")),l.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>V(e.type)&&!e.isExt,componentProps:{options:Object.keys(ee).reduce((e,l)=>($(l,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>me,label:"节点图标",vIf:({formModel:e})=>!f(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!f(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!f(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>V(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!f(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点的路由地址(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!f(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],_e={class:"flex gap-2 ml-2"},yt=j({name:"SysMenu",__name:"index",setup(e){const[l,n]=pe({pagination:!1,size:"small",rowKey:"id",bordered:!0,autoHeight:!0}),[p]=ue(),a=ae();te(document.documentElement,()=>{var t;const o=(t=a==null?void 0:a.proxy)==null?void 0:t.$el;o&&n.setProps({scroll:{x:window.innerWidth>2e3?o.offsetWidth-20:2e3}})});const m=async o=>{var s;const[t]=await p({modalProps:{title:`${o.id?"编辑":"新增"}菜单`,width:700,onFinish:async i=>{o.id&&(i.menuId=o.id),Array.isArray(i.component)&&(i.component=i.component.join("/")),Array.isArray(i.permission)&&(i.permission=i.permission.join(":")),i.parentId===-1&&Reflect.deleteProperty(i,"parentId"),o.id?await y.systemMenu.menuUpdate({id:o.id},i):await y.systemMenu.menuCreate(i),n.reload()}},formProps:{labelWidth:100,schemas:he()}});t==null||t.setFieldsValue({...o,icon:o.icon??"",parentId:o.parentId??-1,component:(s=o.component)==null?void 0:s.split("/")})},v=async o=>{await y.systemMenu.menuDelete({id:o.id}),n.reload()},I=[...ye,{title:"操作",width:160,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:o})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>m(o)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:o.type===2||o.status===0,onClick:()=>m({parentId:o.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>v(o)}}]}];return(o,t)=>{const s=oe("a-button");return _(),k(d(l),{"header-title":"菜单管理","data-request":d(y).systemMenu.menuList,columns:I},{afterHeaderTitle:c(()=>[ne("div",_e,[r(s,{onClick:d(n).expandAll},{default:c(()=>t[1]||(t[1]=[b("展开全部")])),_:1,__:[1]},8,["onClick"]),r(s,{onClick:d(n).collapseAll},{default:c(()=>t[2]||(t[2]=[b("折叠全部")])),_:1,__:[2]},8,["onClick"])])]),toolbar:c(()=>[r(s,{type:"primary",disabled:!o.$auth("system:menu:create"),onClick:t[0]||(t[0]=i=>m({}))},{default:c(()=>t[3]||(t[3]=[b(" 新增 ")])),_:1,__:[3]},8,["disabled"])]),_:1},8,["data-request"])}}});export{yt as default};
