import{B}from"./index-r3xzG294.js";import{T as D}from"./index-D0onqgqk.js";import{e as s,I as C,d as N,B as V,q as j,v as y,F as n,H as r,C as h,J as q,K as u,L as b,a5 as z,x as L,at as f}from"./index-Clv9zNM3.js";import{u as M,b as k}from"./dynamic-table-ewKYMhCK.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DvgRuKxQ.js";import"./dayjs.min-BYaCBWoX.js";import"./index.vue_vue_type_style_index_0_lang-CFCPI4h7.js";import{u as A}from"./useFormModal-B6odna7M.js";import{D as c}from"./index-Cze_hPY3.js";import{P as E}from"./PoweroffOutlined-De4DCiEB.js";import"./isNumeric-DjvBa-1E.js";import"./index-C6XAppnf.js";import"./index-BJ4r8mM4.js";import"./_baseUniq-CsQ8HEXR.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-BCa41I5P.js";import"./move-DRIeMv9s.js";import"./RightOutlined-CtKcSETS.js";import"./VerticalRightOutlined-DF3cgokL.js";import"./cloneDeep-s5SpPfgx.js";import"./schema-form.vue_vue_type_script_setup_true_lang-uF5z2XZj.js";import"./is-fQYYZi7x.js";import"./isNumber-s4abpS_O.js";import"./index-CsLYSjjd.js";import"./useFlexGapSupport-FJ5YreuO.js";import"./hasIn-DoY5MSeO.js";import"./debounce-BtYDntiA.js";import"./QuestionCircleOutlined-B99GTLc_.js";import"./_castArrayLikeObject-BIyyQ4IM.js";import"./index-Binr3P75.js";import"./DownOutlined-DxS2-6Ij.js";import"./index-jwD5cS8J.js";import"./dateUtil-C_wTM_e-.js";import"./pick-DtFW9KKp.js";import"./FullscreenOutlined-DgQLmHrK.js";import"./index-ly56m3IY.js";import"./LeftOutlined-DkJ_dKcN.js";import"./zh_CN-CAyhejr6.js";import"./index-DXPG-Hl7.js";import"./useMergedState-CVClCPu2.js";import"./index-D-la6T6i.js";import"./EnterOutlined-Bw7wTOJA.js";import"./CheckOutlined-C_x0bhih.js";import"./CopyOutlined-DN6DmnBM.js";import"./index-6_t5xb7Y.js";import"./index-C2Yf5-vJ.js";import"./useRefs-CCU70ahe.js";import"./index-BPPLYRCV.js";import"./isMobile-BbN7I0i_.js";import"./index-CYmqXHpm.js";import"./useModal-BtfKNujp.js";var F={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};function I(e){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?Object(arguments[a]):{},p=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(i).filter(function(m){return Object.getOwnPropertyDescriptor(i,m).enumerable}))),p.forEach(function(m){G(e,m,i[m])})}return e}function G(e,a,i){return a in e?Object.defineProperty(e,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[a]=i,e}var g=function(a,i){var p=I({},a,i.attrs);return s(C,I({},p,{icon:F}),null)};g.displayName="CaretRightOutlined";g.inheritAttrs=!1;var H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M876.6 239.5c-.5-.9-1.2-1.8-2-2.5-5-5-13.1-5-18.1 0L684.2 409.3l-67.9-67.9L788.7 169c.8-.8 1.4-1.6 2-2.5 3.6-6.1 1.6-13.9-4.5-17.5-98.2-58-226.8-44.7-311.3 39.7-67 67-89.2 162-66.5 247.4l-293 293c-3 3-2.8 7.9.3 11l169.7 169.7c3.1 3.1 8.1 3.3 11 .3l292.9-292.9c85.5 22.8 180.5.7 247.6-66.4 84.4-84.5 97.7-213.1 39.7-311.3zM786 499.8c-58.1 58.1-145.3 69.3-214.6 33.6l-8.8 8.8-.1-.1-274 274.1-79.2-79.2 230.1-230.1s0 .1.1.1l52.8-52.8c-35.7-69.3-24.5-156.5 33.6-214.6a184.2 184.2 0 01144-53.5L537 318.9a32.05 32.05 0 000 45.3l124.5 124.5a32.05 32.05 0 0045.3 0l132.8-132.8c3.7 51.8-14.4 104.8-53.6 143.9z"}}]},name:"tool",theme:"outlined"};function O(e){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?Object(arguments[a]):{},p=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(i).filter(function(m){return Object.getOwnPropertyDescriptor(i,m).enumerable}))),p.forEach(function(m){J(e,m,i[m])})}return e}function J(e,a,i){return a in e?Object.defineProperty(e,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[a]=i,e}var v=function(a,i){var p=O({},a,i.attrs);return s(C,O({},p,{icon:H}),null)};v.displayName="ToolOutlined";v.inheritAttrs=!1;const U=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},W=e=>{switch(e){case 0:return"停止";case 1:return"运行"}},Q=[{title:"任务名称",dataIndex:"name",width:180},{title:"状态",width:100,dataIndex:"status",customRender:({record:e})=>s(B,{status:e.status===1?"processing":"default",color:U(e.status),text:W(e.status)},null)},{title:"类型",width:80,dataIndex:"type",customRender:({record:e})=>s(D,{color:"processing"},{default:()=>[e.type===1?"Interval":"Cron"]})},{title:"调用服务",dataIndex:"service",hideInSearch:!0,width:220},{title:"执行参数",dataIndex:"data",hideInSearch:!0,width:220},{title:"备注",dataIndex:"remark"}],X=[{field:"type",component:"RadioGroup",label:"名称",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"时间间隔",value:1}]}},{field:"name",component:"Input",label:"任务名称",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"服务路径",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"请输入调用服务的路径"}},{field:"data",component:"Input",label:"任务参数",componentProps:{placeholder:"请输入任务参数（可不填）"}},{field:"limit",component:"InputNumber",label:"执行次数",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>e.type===0,componentProps:{placeholder:"请输入Cron表达式"}},{field:"every",component:"InputNumber",label:"执行间隔",defaultValue:6e4,vIf:({formModel:e})=>e.type===1,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"开始时间",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"结束时间",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",defaultValue:1,label:"状态",componentProps:{options:[{label:"运行",value:1},{label:"停止",value:0}]}}],Wt=N({name:"SystemScheduleTask",__name:"index",setup(e){const[a,i]=M({search:!1,size:"small"}),[p]=A(),m=()=>i==null?void 0:i.reload(),T=async t=>{const[o]=await p({modalProps:{title:`${t.id?"编辑":"新增"}任务`,width:640,onFinish:async d=>{const l={...d,id:t.id};t.id?await f.systemTask.taskUpdate({id:t.id},l):await f.systemTask.taskCreate(l),m()}},formProps:{labelWidth:100,schemas:X}});if(t.id){const d=await f.systemTask.taskInfo({id:t.id});o==null||o.setFieldsValue({...t,...d})}},P=async t=>{await f.systemTask.taskDelete({id:t}),m()},_=async t=>{await f.systemTask.taskOnce({id:t.id}),m()},$=async t=>{await f.systemTask.taskStart({id:t.id}),m()},S=async t=>{await f.systemTask.taskStop({id:t.id}),m()},x=t=>!t.startTime&&!t.endTime?"无时段限制":!t.startTime&&t.endTime?`无开始时间限制 - ${t.endTime}`:t.startTime&&!t.endTime?`${t.startTime} - 长期有效`:`${t.startTime} - ${t.endTime}`,R=[...Q,{title:"操作",width:220,dataIndex:"ACTION",fixed:"right",actions:({record:t})=>[{label:"编辑",auth:{perm:"system:task:update",effect:"disable"},onClick:()=>T(t)},{label:"删除",auth:"system:task:delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>P(t.id)}}]}];return(t,o)=>{const d=V("a-button");return y(),j("div",null,[s(r(a),{"row-key":"id","header-title":"定时任务","data-request":r(f).systemTask.taskList,columns:R,scroll:{x:2e3},bordered:""},{toolbar:n(()=>[s(d,{type:"primary",disabled:!t.$auth("system:task:create"),onClick:o[0]||(o[0]=l=>T({}))},{default:n(()=>o[1]||(o[1]=[u(" 新增 ")])),_:1,__:[1]},8,["disabled"])]),expandedRowRender:n(({record:l})=>[s(r(c),{column:1},{default:n(()=>[s(r(c).Item,{label:"任务编号"},{default:n(()=>[u("# "+b(l.id),1)]),_:2},1024),s(r(c).Item,{label:"执行次数"},{default:n(()=>[u(b(l.limit>0?`仅 ${l.limit} 次`:"无次数限制"),1)]),_:2},1024),l.type===1?(y(),h(r(c).Item,{key:0,label:"执行间隔"},{default:n(()=>[u(" 每"+b(l.every)+"毫秒执行一次 ",1)]),_:2},1024)):(y(),h(r(c).Item,{key:1,label:"Cron表达式"},{default:n(()=>[s(r(z),null,{title:n(()=>o[2]||(o[2]=[u("秒 分 小时 日期 月份 星期 年(可选)")])),default:n(()=>[u(" "+b(l.cron),1)]),_:2},1024)]),_:2},1024)),l.type===0?(y(),h(r(c).Item,{key:2,label:"执行时间段"},{default:n(()=>[L("span",null,b(x(l)),1)]),_:2},1024)):q("",!0),s(r(c).Item,{label:"执行操作"},{default:n(()=>[s(r(k),{title:"确认手动执行一次该任务吗?",disabled:!t.$auth("system:task:once"),onConfirm:w=>_(l)},{default:n(()=>[s(d,{type:"link",size:"small",disabled:!t.$auth("system:task:once")},{icon:n(()=>[s(r(v))]),default:n(()=>[o[3]||(o[3]=u("仅一次 "))]),_:1,__:[3]},8,["disabled"])]),_:2},1032,["disabled","onConfirm"]),s(r(k),{title:"确认运行该任务吗?",disabled:!t.$auth("system:task:start")||l.status!==0,onConfirm:w=>$(l)},{default:n(()=>[s(d,{type:"link",size:"small",disabled:!t.$auth("system:task:start")||l.status!==0},{icon:n(()=>[s(r(g))]),default:n(()=>[o[4]||(o[4]=u("运行 "))]),_:2,__:[4]},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"]),s(r(k),{title:"确认停止该任务吗?",disabled:!t.$auth("system:task:stop")||l.status!==1,onConfirm:w=>S(l)},{default:n(()=>[s(d,{type:"link",size:"small",disabled:!t.$auth("system:task:stop")||l.status!==1},{icon:n(()=>[s(r(E))]),default:n(()=>[o[5]||(o[5]=u("停止 "))]),_:2,__:[5]},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-request"])])}}});export{Wt as default};
