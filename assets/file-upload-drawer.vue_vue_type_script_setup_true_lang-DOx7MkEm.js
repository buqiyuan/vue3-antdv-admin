import{cX as Se,d as Ae,r as U,c as ke,dr as Ie,q as Ue,v as Fe,e as $,H as K,F as J,a_ as Oe,x as W,K as ze,at as Ee,as as Re,cF as Pe,eg as ie,ac as Le}from"./index-Clv9zNM3.js";import{D as Te}from"./index-6s4yWWsS.js";import{_ as De}from"./index-6_t5xb7Y.js";var ve=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},o(t,e)};return function(t,e){o(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),w;(function(o){o.InvalidFile="InvalidFile",o.InvalidToken="InvalidToken",o.InvalidMetadata="InvalidMetadata",o.InvalidChunkSize="InvalidChunkSize",o.InvalidCustomVars="InvalidCustomVars",o.NotAvailableUploadHost="NotAvailableUploadHost",o.ReadCacheFailed="ReadCacheFailed",o.InvalidCacheData="InvalidCacheData",o.WriteCacheFailed="WriteCacheFailed",o.RemoveCacheFailed="RemoveCacheFailed",o.GetCanvasContextFailed="GetCanvasContextFailed",o.UnsupportedFileType="UnsupportedFileType",o.FileReaderReadFailed="FileReaderReadFailed",o.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",o.InvalidProgressEventTarget="InvalidProgressEventTarget",o.RequestError="RequestError"})(w||(w={}));var x=function(){function o(t,e){this.name=t,this.message=e,this.stack=new Error().stack}return o}(),M=function(o){ve(t,o);function t(e,r,i,n){var l=o.call(this,w.RequestError,i)||this;return l.code=e,l.reqId=r,l.isRequestError=!0,l.data=n,l}return t}(x),qe=function(o){ve(t,o);function t(e,r){return r===void 0&&(r=""),o.call(this,0,r,e)||this}return t}(M),He=function(){function o(t,e){this.runTask=t,this.limit=e,this.aborted=!1,this.queue=[],this.processing=[]}return o.prototype.enqueue=function(t){var e=this;return new Promise(function(r,i){e.queue.push({task:t,resolve:r,reject:i}),e.check()})},o.prototype.run=function(t){var e=this;this.queue=this.queue.filter(function(r){return r!==t}),this.processing.push(t),this.runTask(t.task).then(function(){e.processing=e.processing.filter(function(r){return r!==t}),t.resolve(),e.check()},function(r){return t.reject(r)})},o.prototype.check=function(){var t=this;if(!this.aborted){var e=this.processing.length,r=this.limit-e;this.queue.slice(0,r).forEach(function(i){t.run(i)})}},o.prototype.abort=function(){this.queue=[],this.aborted=!0},o}(),Be=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},o(t,e)};return function(t,e){o(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),H=function(){return H=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},H.apply(this,arguments)},Me=function(){function o(){this.closed=!1}return o.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},o.prototype.add=function(t){this._unsubscribe=t},o}(),je=function(o){Be(t,o);function t(e,r,i){var n=o.call(this)||this;return n.isStopped=!1,e&&typeof e=="object"?n.destination=e:n.destination=H(H(H({},e&&{next:e}),r&&{error:r}),i&&{complete:i}),n}return t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},t.prototype.next=function(e){!this.isStopped&&this.destination.next&&this.destination.next(e)},t.prototype.error=function(e){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(e))},t.prototype.complete=function(e){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(e))},t}(Me),$e=function(){function o(t){this._subscribe=t}return o.prototype.subscribe=function(t,e,r){var i=new je(t,e,r);return i.add(this._subscribe(i)),i},o}();function Ve(o){if(o===null||typeof o>"u")return"";var t=o+"",e="",r,i,n=0;r=i=0,n=t.length;for(var l=0;l<n;l++){var d=t.charCodeAt(l),g=null;if(d<128)i++;else if(d>127&&d<2048)g=String.fromCharCode(d>>6|192,d&63|128);else if((d&63488^55296)>0)g=String.fromCharCode(d>>12|224,d>>6&63|128,d&63|128);else{if((d&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+l);var a=t.charCodeAt(++l);if((a&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(l-1));d=((d&1023)<<10)+(a&1023)+65536,g=String.fromCharCode(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}g!==null&&(i>r&&(e+=t.slice(r,i)),e+=g,r=i=l+1)}return i>r&&(e+=t.slice(r,n)),e}function Ne(o){var t=[],e=0,r=0,i=0;for(o+="";e<o.length;){r=o.charCodeAt(e)&255,i=0,r<=191?(r=r&127,i=1):r<=223?(r=r&31,i=2):r<=239?(r=r&15,i=3):(r=r&7,i=4);for(var n=1;n<i;++n)r=r<<6|o.charCodeAt(n+e)&63;i===4?(r-=65536,t.push(String.fromCharCode(55296|r>>10&1023)),t.push(String.fromCharCode(56320|r&1023))):t.push(String.fromCharCode(r)),e+=i}return t.join("")}function Ge(o){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,r,i,n,l,d,g,a,h=0,v=0,b="",C=[];if(!o)return o;o=Ve(o+"");do e=o.charCodeAt(h++),r=o.charCodeAt(h++),i=o.charCodeAt(h++),a=e<<16|r<<8|i,n=a>>18&63,l=a>>12&63,d=a>>6&63,g=a&63,C[v++]=t.charAt(n)+t.charAt(l)+t.charAt(d)+t.charAt(g);while(h<o.length);switch(b=C.join(""),o.length%3){case 1:b=b.slice(0,-2)+"==";break;case 2:b=b.slice(0,-1)+"=";break}return b}function Xe(o){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,r,i,n,l,d,g,a,h=0,v=0,b="",C=[];if(!o)return o;o+="";do n=t.indexOf(o.charAt(h++)),l=t.indexOf(o.charAt(h++)),d=t.indexOf(o.charAt(h++)),g=t.indexOf(o.charAt(h++)),a=n<<18|l<<12|d<<6|g,e=a>>16&255,r=a>>8&255,i=a&255,d===64?C[v++]=String.fromCharCode(e):g===64?C[v++]=String.fromCharCode(e,r):C[v++]=String.fromCharCode(e,r,i);while(h<o.length);return b=C.join(""),Ne(b)}function me(o){return o=Ge(o),o.replace(/\//g,"_").replace(/\+/g,"-")}function Ke(o){return o=o.replace(/_/g,"/").replace(/-/g,"+"),Xe(o)}var Z={exports:{}},oe;function Je(){return oe||(oe=1,function(o,t){(function(e){o.exports=e()})(function(e){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(y,p){var u=y[0],s=y[1],f=y[2],c=y[3];u+=(s&f|~s&c)+p[0]-680876936|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[1]-389564586|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[2]+606105819|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[3]-1044525330|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[4]-176418897|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[5]+1200080426|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[6]-1473231341|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[7]-45705983|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[9]-1958414417|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[10]-42063|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[11]-1990404162|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[13]-40341101|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[14]-1502002290|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[15]+1236535329|0,s=(s<<22|s>>>10)+f|0,u+=(s&c|f&~c)+p[1]-165796510|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[6]-1069501632|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[11]+643717713|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[0]-373897302|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[5]-701558691|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[10]+38016083|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[15]-660478335|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[4]-405537848|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[9]+568446438|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[14]-1019803690|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[3]-187363961|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[8]+1163531501|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[2]-51403784|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[7]+1735328473|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[12]-1926607734|0,s=(s<<20|s>>>12)+f|0,u+=(s^f^c)+p[5]-378558|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[8]-2022574463|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[11]+1839030562|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[14]-35309556|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[4]+1272893353|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[7]-155497632|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[10]-1094730640|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[13]+681279174|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[0]-358537222|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[3]-722521979|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[6]+76029189|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[9]-640364487|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[12]-421815835|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[15]+530742520|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[2]-995338651|0,s=(s<<23|s>>>9)+f|0,u+=(f^(s|~c))+p[0]-198630844|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[7]+1126891415|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[14]-1416354905|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[5]-57434055|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[3]-1894986606|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[10]-1051523|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[1]-2054922799|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[15]-30611744|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[6]-1560198380|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[13]+1309151649|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[4]-145523070|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[11]-1120210379|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[2]+718787259|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[9]-343485551|0,s=(s<<21|s>>>11)+f|0,y[0]=u+y[0]|0,y[1]=s+y[1]|0,y[2]=f+y[2]|0,y[3]=c+y[3]|0}function n(y){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=y.charCodeAt(u)+(y.charCodeAt(u+1)<<8)+(y.charCodeAt(u+2)<<16)+(y.charCodeAt(u+3)<<24);return p}function l(y){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=y[u]+(y[u+1]<<8)+(y[u+2]<<16)+(y[u+3]<<24);return p}function d(y){var p=y.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,_,A,I;for(s=64;s<=p;s+=64)i(u,n(y.substring(s-64,s)));for(y=y.substring(s-64),f=y.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=y.charCodeAt(s)<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(i(u,c),s=0;s<16;s+=1)c[s]=0;return _=p*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),A=parseInt(_[2],16),I=parseInt(_[1],16)||0,c[14]=A,c[15]=I,i(u,c),u}function g(y){var p=y.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,_,A,I;for(s=64;s<=p;s+=64)i(u,l(y.subarray(s-64,s)));for(y=s-64<p?y.subarray(s-64):new Uint8Array(0),f=y.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=y[s]<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(i(u,c),s=0;s<16;s+=1)c[s]=0;return _=p*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),A=parseInt(_[2],16),I=parseInt(_[1],16)||0,c[14]=A,c[15]=I,i(u,c),u}function a(y){var p="",u;for(u=0;u<4;u+=1)p+=r[y>>u*8+4&15]+r[y>>u*8&15];return p}function h(y){var p;for(p=0;p<y.length;p+=1)y[p]=a(y[p]);return y.join("")}h(d("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function y(p,u){return p=p|0||0,p<0?Math.max(p+u,0):Math.min(p,u)}ArrayBuffer.prototype.slice=function(p,u){var s=this.byteLength,f=y(p,s),c=s,_,A,I,T;return u!==e&&(c=y(u,s)),f>c?new ArrayBuffer(0):(_=c-f,A=new ArrayBuffer(_),I=new Uint8Array(A),T=new Uint8Array(this,f,_),I.set(T),A)}}();function v(y){return/[\u0080-\uFFFF]/.test(y)&&(y=unescape(encodeURIComponent(y))),y}function b(y,p){var u=y.length,s=new ArrayBuffer(u),f=new Uint8Array(s),c;for(c=0;c<u;c+=1)f[c]=y.charCodeAt(c);return p?f:s}function C(y){return String.fromCharCode.apply(null,new Uint8Array(y))}function S(y,p,u){var s=new Uint8Array(y.byteLength+p.byteLength);return s.set(new Uint8Array(y)),s.set(new Uint8Array(p),y.byteLength),s}function k(y){var p=[],u=y.length,s;for(s=0;s<u-1;s+=2)p.push(parseInt(y.substr(s,2),16));return String.fromCharCode.apply(String,p)}function m(){this.reset()}return m.prototype.append=function(y){return this.appendBinary(v(y)),this},m.prototype.appendBinary=function(y){this._buff+=y,this._length+=y.length;var p=this._buff.length,u;for(u=64;u<=p;u+=64)i(this._hash,n(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},m.prototype.end=function(y){var p=this._buff,u=p.length,s,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c;for(s=0;s<u;s+=1)f[s>>2]|=p.charCodeAt(s)<<(s%4<<3);return this._finish(f,u),c=h(this._hash),y&&(c=k(c)),this.reset(),c},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(y){return this._buff=y.buff,this._length=y.length,this._hash=y.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(y,p){var u=p,s,f,c;if(y[u>>2]|=128<<(u%4<<3),u>55)for(i(this._hash,y),u=0;u<16;u+=1)y[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(s[2],16),c=parseInt(s[1],16)||0,y[14]=f,y[15]=c,i(this._hash,y)},m.hash=function(y,p){return m.hashBinary(v(y),p)},m.hashBinary=function(y,p){var u=d(y),s=h(u);return p?k(s):s},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(y){var p=S(this._buff.buffer,y),u=p.length,s;for(this._length+=y.byteLength,s=64;s<=u;s+=64)i(this._hash,l(p.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(p.buffer.slice(s-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(y){var p=this._buff,u=p.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f,c;for(f=0;f<u;f+=1)s[f>>2]|=p[f]<<(f%4<<3);return this._finish(s,u),c=h(this._hash),y&&(c=k(c)),this.reset(),c},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var y=m.prototype.getState.call(this);return y.buff=C(y.buff),y},m.ArrayBuffer.prototype.setState=function(y){return y.buff=b(y.buff,!0),m.prototype.setState.call(this,y)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(y,p){var u=g(new Uint8Array(y)),s=h(u);return p?k(s):s},m})}(Z)),Z.exports}var We=Je();const Ze=Se(We);var N=function(){return N=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},N.apply(this,arguments)},Ye=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},Qe=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},P=Math.pow(1024,2);function et(o,t){var e=t*P;if(e>o.size)e=o.size;else for(;o.size>e*1e4;)e*=2;for(var r=[],i=Math.ceil(o.size/e),n=0;n<i;n++){var l=o.slice(e*n,n===i-1?o.size:e*(n+1));r.push(l)}return r}function tt(o){return Object.keys(o).every(function(t){return t.indexOf("x-qn-meta-")===0})}function nt(o){return Object.keys(o).every(function(t){return t.indexOf("x:")===0})}function rt(o){return o.reduce(function(t,e){return t+e},0)}function it(o,t,e){try{localStorage.setItem(o,JSON.stringify(t))}catch{e.warn(new x(w.WriteCacheFailed,"setLocalFileInfo failed: "+o))}}function ot(o,t,e){var r=t==null?"_":"_key_"+t+"_";return"qiniu_js_sdk_upload_file_name_"+o+r+"size_"+e}function ne(o,t){try{localStorage.removeItem(o)}catch{t.warn(new x(w.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+o))}}function at(o,t){var e=null;try{e=localStorage.getItem(o)}catch{t.warn(new x(w.ReadCacheFailed,"getLocalFileInfo failed. key: "+o))}if(e==null)return null;var r=null;try{r=JSON.parse(e)}catch{ne(o,t),t.warn(new x(w.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+o))}return r}function X(o){var t="UpToken "+o;return{Authorization:t}}function st(o){var t=X(o);return N({"content-type":"application/octet-stream"},t)}function ut(o){var t=X(o);return N({"content-type":"application/json"},t)}function be(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new x(w.NotAvailableXMLHttpRequest,"the current environment does not support.")}function ct(o){return Ye(this,void 0,void 0,function(){var t,e;return Qe(this,function(r){switch(r.label){case 0:return[4,ft(o)];case 1:return t=r.sent(),e=new Ze.ArrayBuffer,e.append(t),[2,e.end()]}})})}function ft(o){return new Promise(function(t,e){var r=new FileReader;r.onload=function(i){if(i.target){var n=i.target.result;t(n)}else e(new x(w.InvalidProgressEventTarget,"progress event target is undefined"))},r.onerror=function(){e(new x(w.FileReaderReadFailed,"fileReader read failed"))},r.readAsArrayBuffer(o)})}function j(o,t){return new Promise(function(e,r){var i=be();if(i.open(t.method,o),t.onCreate&&t.onCreate(i),t.headers){var n=t.headers;Object.keys(n).forEach(function(l){i.setRequestHeader(l,n[l])})}i.upload.addEventListener("progress",function(l){l.lengthComputable&&t.onProgress&&t.onProgress({loaded:l.loaded,total:l.total})}),i.onreadystatechange=function(){var l=i.responseText;if(i.readyState===4){var d=i.getResponseHeader("x-reqId")||"";if(i.status===0){r(new qe("network error.",d));return}if(i.status!==200){var g="xhr request failed, code: "+i.status;l&&(g+=" response: "+l);var a=void 0;try{a=JSON.parse(l)}catch{}r(new M(i.status,d,g,a));return}try{e({data:JSON.parse(l),reqId:d})}catch(h){r(h)}}},i.send(t.body)})}function lt(o){if(o&&o.match){var t=o.match(/(^https?)/);if(!t)return"";var e=t[1];return t=o.match(/^https?:\/\/([^:^/]*):(\d*)/),t?t[2]:e==="http"?"80":"443"}return""}function ht(o){if(o&&o.match){var t=o.match(/^https?:\/\/([^:^/]*)/);return t?t[1]:""}return""}function re(o){if(!o)throw new x(w.InvalidToken,"invalid token.");var t=o.split(":");if(t.length===1)throw new x(w.InvalidToken,"invalid token segments.");var e=t.length>3?t[1]:t[0];if(!e)throw new x(w.InvalidToken,"missing assess key field.");var r=null;try{r=JSON.parse(Ke(t[t.length-1]))}catch{throw new x(w.InvalidToken,"token parse failed.")}if(r==null)throw new x(w.InvalidToken,"putPolicy is null.");if(r.scope==null)throw new x(w.InvalidToken,"scope field is null.");var i=r.scope.split(":")[0];if(!i)throw new x(w.InvalidToken,"resolve bucketName failed.");return{assessKey:e,bucketName:i,scope:r.scope}}var F,E={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},dt=(F={},F[E.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},F[E.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},F[E.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},F[E.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},F[E.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},F[E.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},F),R={},Y,ae;function pt(){if(ae)return Y;ae=1;function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}return Y=function(t,e,r,i){e=e||"&",r=r||"=";var n={};if(typeof t!="string"||t.length===0)return n;var l=/\+/g;t=t.split(e);var d=1e3;i&&typeof i.maxKeys=="number"&&(d=i.maxKeys);var g=t.length;d>0&&g>d&&(g=d);for(var a=0;a<g;++a){var h=t[a].replace(l,"%20"),v=h.indexOf(r),b,C,S,k;v>=0?(b=h.substr(0,v),C=h.substr(v+1)):(b=h,C=""),S=decodeURIComponent(b),k=decodeURIComponent(C),o(n,S)?Array.isArray(n[S])?n[S].push(k):n[S]=[n[S],k]:n[S]=k}return n},Y}var Q,se;function yt(){if(se)return Q;se=1;var o=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};return Q=function(t,e,r,i){return e=e||"&",r=r||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(n){var l=encodeURIComponent(o(n))+r;return Array.isArray(t[n])?t[n].map(function(d){return l+encodeURIComponent(o(d))}).join(e):l+encodeURIComponent(o(t[n]))}).filter(Boolean).join(e):i?encodeURIComponent(o(i))+r+encodeURIComponent(o(t)):""},Q}var ue;function gt(){return ue||(ue=1,R.decode=R.parse=pt(),R.encode=R.stringify=yt()),R}var vt=gt(),O=function(){return O=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},O.apply(this,arguments)},mt=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},bt=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function wt(o,t,e){return mt(this,void 0,void 0,function(){var r,i;return bt(this,function(n){return r=vt.stringify({ak:o,bucket:t}),i=e+"://api.qiniu.com/v2/query?"+r,[2,j(i,{method:"GET"})]})})}function we(o,t,e){var r=e.url,i=e.id;return r+"/buckets/"+o+"/objects/"+(t!=null?me(t):"~")+"/uploads/"+i}function _t(o,t,e,r){var i=r+"/buckets/"+t+"/objects/"+(e!=null?me(e):"~")+"/uploads";return j(i,{method:"POST",headers:X(o)})}function xt(o,t,e,r,i){var n=re(o).bucketName,l=we(n,t,r)+("/"+e),d=st(o);return i.md5&&(d["Content-MD5"]=i.md5),j(l,O(O({},i),{method:"PUT",headers:d}))}function Ct(o,t,e,r){var i=re(o).bucketName,n=we(i,t,e);return j(n,O(O({},r),{method:"POST",headers:ut(o)}))}function St(o,t,e){return j(o,O({method:"POST",body:t},e))}var G=function(){return G=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},G.apply(this,arguments)},ce=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},fe=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},At=function(o,t){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),i,n=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(d){l={error:d}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return n},kt=function(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(At(arguments[t]));return o},It=4,_e=[0,502,503,504,599],Ut=kt(_e,[612]),Ft=Math.pow(1024,3),xe=function(){function o(t,e,r,i){this.hostPool=r,this.logger=i,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=t.config,i.info("config inited.",this.config),this.putExtra=G({fname:""},t.putExtra),i.info("putExtra inited.",this.putExtra),this.key=t.key,this.file=t.file,this.token=t.token,this.onData=e.onData,this.onError=e.onError,this.onComplete=e.onComplete;try{var n=re(this.token);this.bucketName=n.bucketName,this.assessKey=n.assessKey}catch(l){i.error("get putPolicy from token failed.",l),this.onError(l)}}return o.prototype.checkAndUpdateUploadHost=function(){return ce(this,void 0,void 0,function(){var t;return fe(this,function(e){switch(e.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(t=e.sent(),t==null)throw new x(w.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==t.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+t.host+"."):this.logger.info("use host "+t.host+"."),this.uploadHost=t,[2]}})})},o.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},o.prototype.checkAndFreezeHost=function(t){this.logger.info("check freeze host."),t instanceof M&&this.uploadHost!=null&&_e.includes(t.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},o.prototype.handleError=function(t){this.logger.error(t.message),this.onError(t)},o.prototype.putFile=function(){return ce(this,void 0,void 0,function(){var t,e,r,i;return fe(this,function(n){switch(n.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*Ft)return this.handleError(new x(w.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!nt(this.putExtra.customVars))return this.handleError(new x(w.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!tt(this.putExtra.metadata))return this.handleError(new x(w.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];n.label=1;case 1:return n.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return n.sent(),[4,this.run()];case 3:return t=n.sent(),this.onComplete(t.data),this.checkAndUnfreezeHost(),this.sendLog(t.reqId,200),[2];case 4:return e=n.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(e),e instanceof M&&(this.sendLog(e.reqId,e.code),this.checkAndFreezeHost(e),r=++this.retryCount<=this.config.retryCount,i=Ut.includes(e.code),i&&r)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(e),[3,5]));case 5:return[2]}})})},o.prototype.clear=function(){this.xhrList.forEach(function(t){t.onreadystatechange=null,t.abort()}),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},o.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},o.prototype.addXhr=function(t){this.xhrList.push(t)},o.prototype.sendLog=function(t,e){var r,i;this.logger.report({code:e,reqId:t,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:lt((r=this.uploadHost)===null||r===void 0?void 0:r.getUrl()),host:ht((i=this.uploadHost)===null||i===void 0?void 0:i.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},o.prototype.getProgressInfoItem=function(t,e,r){return G({size:e,loaded:t,percent:t/e*100},r==null?{}:{fromCache:r})},o}(),Ot=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},o(t,e)};return function(t,e){o(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),B=function(){return B=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},B.apply(this,arguments)},D=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},q=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function zt(o){var t=/^[1-9]\d*$/;return t.test(String(o))}var Et=function(o){Ot(t,o);function t(){return o!==null&&o.apply(this,arguments)||this}return t.prototype.run=function(){return D(this,void 0,void 0,function(){var e,r,i,n,l,d=this;return q(this,function(g){switch(g.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!zt(this.config.chunkSize))throw new x(w.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new x(w.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:g.sent(),e=new He(function(a){return D(d,void 0,void 0,function(){return q(this,function(h){switch(h.label){case 0:if(this.aborted)throw e.abort(),new Error("pool is aborted");return[4,this.uploadChunk(a)];case 1:return h.sent(),[2]}})})},this.config.concurrentRequestLimit),r=null,i=this.getLocalKey(),n=this.chunks.map(function(a,h){return e.enqueue({chunk:a,index:h})}),g.label=2;case 2:return g.trys.push([2,5,,6]),[4,Promise.all(n)];case 3:return g.sent(),[4,this.mkFileReq()];case 4:return r=g.sent(),[3,6];case 5:throw l=g.sent(),l instanceof M&&(l.code===612||l.code===400)&&ne(i,this.logger),l;case 6:return ne(i,this.logger),[2,r]}})})},t.prototype.uploadChunk=function(e){return D(this,void 0,void 0,function(){var r,i,n,l,d,g,a,h,v,b=this;return q(this,function(C){switch(C.label){case 0:return r=e.index,i=e.chunk,n=this.cachedUploadedList[r],this.logger.info("upload part "+r+", cache:",n),l=this.config.checkByMD5,d=function(){b.usedCacheList[r]=!0,b.updateChunkProgress(i.size,r),b.uploadedList[r]=n,b.updateLocalCache()},n&&!l?(d(),[2]):[4,ct(i)];case 1:return g=C.sent(),this.logger.info("computed part md5.",g),n&&g===n.md5?(d(),[2]):(this.usedCacheList[r]=!1,a=function(S){b.updateChunkProgress(S.loaded,r)},h={body:i,md5:this.config.checkByServer?g:void 0,onProgress:a,onCreate:function(S){return b.addXhr(S)}},this.logger.info("part "+r+" start uploading."),[4,xt(this.token,this.key,e.index+1,this.getUploadInfo(),h)]);case 2:return v=C.sent(),this.logger.info("part "+r+" upload completed."),a({loaded:i.size,total:i.size}),this.uploadedList[r]={etag:v.data.etag,md5:v.data.md5,size:i.size},this.updateLocalCache(),[2]}})})},t.prototype.mkFileReq=function(){return D(this,void 0,void 0,function(){var e,r,i=this;return q(this,function(n){switch(n.label){case 0:return e=B(B(B({parts:this.uploadedList.map(function(l,d){return{etag:l.etag,partNumber:d+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",e),[4,Ct(this.token,this.key,this.getUploadInfo(),{onCreate:function(l){return i.addXhr(l)},body:JSON.stringify(e)})];case 1:return r=n.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,r]}})})},t.prototype.initBeforeUploadChunks=function(){return D(this,void 0,void 0,function(){var e,r,i;return q(this,function(n){switch(n.label){case 0:return this.uploadedList=[],this.usedCacheList=[],e=at(this.getLocalKey(),this.logger),e?[3,2]:(this.logger.info("init upload parts from api."),[4,_t(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return r=n.sent(),this.logger.info("initd upload parts of id: "+r.data.uploadId+"."),this.uploadId=r.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:i=["resume upload parts from local cache,","total "+e.data.length+" part,","id is "+e.id+"."],this.logger.info(i.join(" ")),this.cachedUploadedList=e.data,this.uploadId=e.id,n.label=3;case 3:return this.chunks=et(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(l){return 0})},this.notifyResumeProgress(),[2]}})})},t.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},t.prototype.getLocalKey=function(){return ot(this.file.name,this.key,this.file.size)},t.prototype.updateLocalCache=function(){it(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},t.prototype.updateChunkProgress=function(e,r){this.loaded.chunks[r]=e,this.notifyResumeProgress()},t.prototype.updateMkFileProgress=function(e){this.loaded.mkFileProgress=e,this.notifyResumeProgress()},t.prototype.notifyResumeProgress=function(){var e=this;this.progress={total:this.getProgressInfoItem(rt(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(r,i){var n=e.usedCacheList[i];return e.getProgressInfoItem(e.loaded.chunks[i],r.size,n)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},t}(xe),le=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},he=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Rt=function(){function o(){this.crc=-1,this.table=this.makeTable()}return o.prototype.makeTable=function(){for(var t=new Array,e=0;e<256;e++){for(var r=e,i=0;i<8;i++)r&1?r=r>>>1^3988292384:r>>>=1;t[e]=r}return t},o.prototype.append=function(t){for(var e=this.crc,r=0;r<t.byteLength;r++)e=e>>>8^this.table[(e^t[r])&255];this.crc=e},o.prototype.compute=function(){return(this.crc^-1)>>>0},o.prototype.readAsUint8Array=function(t){return le(this,void 0,void 0,function(){var e;return he(this,function(r){switch(r.label){case 0:return typeof t.arrayBuffer!="function"?[3,2]:(e=Uint8Array.bind,[4,t.arrayBuffer()]);case 1:return[2,new(e.apply(Uint8Array,[void 0,r.sent()]))];case 2:return[2,new Promise(function(i,n){var l=new FileReader;l.onload=function(){if(l.result==null){n();return}if(typeof l.result=="string"){n();return}i(new Uint8Array(l.result))},l.readAsArrayBuffer(t)})]}})})},o.prototype.file=function(t){return le(this,void 0,void 0,function(){var e,r,i,n,l,d;return he(this,function(g){switch(g.label){case 0:return t.size<=P?(e=this.append,[4,this.readAsUint8Array(t)]):[3,2];case 1:return e.apply(this,[g.sent()]),[2,this.compute()];case 2:r=Math.ceil(t.size/P),i=0,g.label=3;case 3:return i<r?(n=i*P,l=i===r-1?t.size:n+P,[4,this.readAsUint8Array(t.slice(n,l))]):[3,6];case 4:d=g.sent(),this.append(new Uint8Array(d)),g.label=5;case 5:return i++,[3,3];case 6:return[2,this.compute()]}})})},o.file=function(t){var e=new o;return e.file(t)},o}(),Pt=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},o(t,e)};return function(t,e){o(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Lt=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},Tt=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},de=function(o){Pt(t,o);function t(){return o!==null&&o.apply(this,arguments)||this}return t.prototype.run=function(){return Lt(this,void 0,void 0,function(){var e,r,i,n,l,d=this;return Tt(this,function(g){switch(g.label){case 0:return this.logger.info("start run Direct."),e=new FormData,e.append("file",this.file),e.append("token",this.token),this.key!=null&&e.append("key",this.key),e.append("fname",this.putExtra.fname),this.config.checkByServer?[4,Rt.file(this.file)]:[3,2];case 1:r=g.sent(),e.append("crc32",r.toString()),g.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),i=this.putExtra.customVars,Object.keys(i).forEach(function(a){return e.append(a,i[a].toString())}),this.logger.info("customVars inited.")),this.putExtra.metadata&&(this.logger.info("init metadata."),n=this.putExtra.metadata,Object.keys(n).forEach(function(a){return e.append(a,n[a].toString())})),this.logger.info("formData inited."),[4,St(this.uploadHost.getUrl(),e,{onProgress:function(a){d.updateDirectProgress(a.loaded,a.total)},onCreate:function(a){return d.addXhr(a)}})];case 3:return l=g.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,l]}})})},t.prototype.updateDirectProgress=function(e,r){this.progress={total:this.getProgressInfoItem(e,r+1)},this.onData(this.progress)},t.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var e=this.progress.total;this.progress={total:this.getProgressInfoItem(e.loaded+1,e.size)},this.onData(this.progress)},t}(xe);function Ce(o,t,e){e===void 0&&(e=3);var r=be();r.open("POST","https://uplog.qbox.me/log/3"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Authorization",X(o).Authorization),r.onreadystatechange=function(){r.readyState===4&&r.status!==200&&e>0&&Ce(o,t,e-1)};var i=[t.code||"",t.reqId||"",t.host||"",t.remoteIp||"",t.port||"",t.duration||"",t.time||"",t.bytesSent||"",t.upType||"",t.size||""].join(",");r.send(i)}var Dt=function(o,t){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),i,n=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(d){l={error:d}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return n},ee=function(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Dt(arguments[t]));return o},qt=function(){function o(t,e,r,i){e===void 0&&(e=!0),r===void 0&&(r="OFF"),i===void 0&&(i="UPLOAD"),this.token=t,this.disableReport=e,this.level=r,this.prefix=i,this.id=++o.id}return o.prototype.getPrintPrefix=function(t){return"Qiniu-JS-SDK ["+t+"]["+this.prefix+"#"+this.id+"]:"},o.prototype.report=function(t,e){if(!this.disableReport)try{Ce(this.token,t,e)}catch(r){this.warn(r)}},o.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=["INFO"];r.includes(this.level)&&console.log.apply(console,ee([this.getPrintPrefix("INFO")],t))},o.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=["INFO","WARN"];r.includes(this.level)&&console.warn.apply(console,ee([this.getPrintPrefix("WARN")],t))},o.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=["INFO","WARN","ERROR"];r.includes(this.level)&&console.error.apply(console,ee([this.getPrintPrefix("ERROR")],t))},o.id=0,o}(),pe=function(o,t,e,r){function i(n){return n instanceof e?n:new e(function(l){l(n)})}return new(e||(e=Promise))(function(n,l){function d(h){try{a(r.next(h))}catch(v){l(v)}}function g(h){try{a(r.throw(h))}catch(v){l(v)}}function a(h){h.done?n(h.value):i(h.value).then(d,g)}a((r=r.apply(o,t||[])).next())})},ye=function(o,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return g([a,h])}}function g(a){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=a[0]&2?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(o,e)}catch(h){a=[6,h],i=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Ht=function(o,t){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),i,n=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(d){l={error:d}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return n},Bt=function(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Ht(arguments[t]));return o},V=new Map,Mt=function(){function o(t,e){this.host=t,this.protocol=e}return o.prototype.isFrozen=function(){var t=new Date().getTime(),e=V.get(this.host);return e!=null&&e>=t},o.prototype.freeze=function(t){t===void 0&&(t=20);var e=new Date().getTime()+t*1e3;V.set(this.host,e)},o.prototype.unfreeze=function(){V.delete(this.host)},o.prototype.getUrl=function(){return this.protocol+"://"+this.host},o.prototype.getUnfreezeTime=function(){return V.get(this.host)},o}(),jt=function(){function o(t){t===void 0&&(t=[]),this.initHosts=t,this.cachedHostsMap=new Map}return o.prototype.register=function(t,e,r,i){this.cachedHostsMap.set(t+"@"+e,r.map(function(n){return new Mt(n,i)}))},o.prototype.refresh=function(t,e,r){var i,n,l,d;return pe(this,void 0,void 0,function(){var g,a,h;return ye(this,function(v){switch(v.label){case 0:return g=this.cachedHostsMap.get(t+"@"+e)||[],g.length>0?[2]:this.initHosts.length>0?(this.register(t,e,this.initHosts,r),[2]):[4,wt(t,e,r)];case 1:return a=v.sent(),(a==null?void 0:a.data)!=null&&(h=Bt(((n=(i=a.data.up)===null||i===void 0?void 0:i.acc)===null||n===void 0?void 0:n.main)||[],((d=(l=a.data.up)===null||l===void 0?void 0:l.acc)===null||d===void 0?void 0:d.backup)||[]),this.register(t,e,h,r)),[2]}})})},o.prototype.getUp=function(t,e,r){return pe(this,void 0,void 0,function(){var i,n,l;return ye(this,function(d){switch(d.label){case 0:return[4,this.refresh(t,e,r)];case 1:return d.sent(),i=this.cachedHostsMap.get(t+"@"+e)||[],i.length===0?[2,null]:(n=i.filter(function(g){return!g.isFrozen()}),n.length>0?[2,n[0]]:(l=i.slice().sort(function(g,a){return(g.getUnfreezeTime()||0)-(a.getUnfreezeTime()||0)}),[2,l[0]]))}})})},o}();function $t(o,t,e,r){return o.config&&o.config.forceDirect?(r.info("ues forceDirect mode."),new de(o,t,e,r)):o.file.size>4*P?(r.info("file size over 4M, use Resume."),new Et(o,t,e,r)):(r.info("file size less or equal than 4M, use Direct."),new de(o,t,e,r))}function Vt(o,t,e,r,i){var n=new qt(e,void 0,void 0,o.name),l={file:o,key:t,token:e,putExtra:r,config:Xt(i)},d=new jt(l.config.uphost);return new $e(function(g){var a=$t(l,{onData:function(h){return g.next(h)},onError:function(h){return g.error(h)},onComplete:function(h){return g.complete(h)}},d,n);return a.putFile(),a.stop.bind(a)})}var L=function(){return L=Object.assign||function(o){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},L.apply(this,arguments)},Nt=function(o,t){var e={};for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&t.indexOf(r)<0&&(e[r]=o[r]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(o);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(o,r[i])&&(e[r[i]]=o[r[i]]);return e},Gt=function(o,t){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),i,n=[],l;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(d){l={error:d}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(l)throw l.error}}return n},te=function(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(Gt(arguments[t]));return o};function Xt(o,t){var e=L({},o),r=e.upprotocol,i=e.uphost,n=Nt(e,["upprotocol","uphost"]),l=L({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!1,concurrentRequestLimit:3,chunkSize:It,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},n);r&&(l.upprotocol=r.replace(/:$/,""));var d=[];if(i)Array.isArray(i)?d.push.apply(d,te(i)):d.push(i);else if(l!=null&&l.region){var g=dt[l==null?void 0:l.region];l.useCdnDomain?d.push.apply(d,te(g.cdnUphost)):d.push.apply(d,te(g.srcUphost))}return L(L({},l),{uphost:d.filter(Boolean)})}var ge={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"};Object.keys(ge).map(function(o){return ge[o]});const Kt={class:"file-upload-drawer-container"},Yt=Ae({name:"FileUploadDrawer",__name:"file-upload-drawer",emits:["changed"],setup(o,{expose:t,emit:e}){const r=e,i=U(),n=U(!1),l=U(!1),d=U(""),g=U(""),a=U([]),h=U([]),v=U([]),b=ke(()=>`上传文件到${Ie(d.value)?"根":d.value.substring(0,d.value.length-1)}目录`),C=s=>{d.value=s,l.value=!0,n.value=!0,Ee.netDiskManage.netDiskManageToken().then(f=>{g.value=f.token,n.value=!1}).catch(()=>{l.value=!1})},S=()=>{a.value.length>0&&a.value.length!==h.value.length?Re.confirm({title:"关闭会取消未上传的文件，确认关闭吗？",icon:$(Pe),onOk:k}):k()},k=()=>{l.value=!1,n.value=!1,d.value="",g.value="",v.value=[],u()},m=s=>{const{file:f,onProgress:c,onError:_,onSuccess:A}=s,T=Vt(f,`${d.value}${f.name}`,g.value).subscribe({next:z=>{c==null||c({percent:z.total.percent})},error:z=>{_==null||_(z),y(z,f)},complete:z=>{h.value.push(T),A==null||A(z),p(f)}});a.value.push(T)},y=(s,f)=>{const c=v.value.find(_=>_.originFileObj===f);c&&(c.status="error"),ie.error({message:"上传进度提醒",description:`上传${f==null?void 0:f.name}文件失败！错误信息：${s.code===614?"上传文件已存在":s.message}`,duration:0})},p=s=>{const f=v.value.find(c=>c.originFileObj===s);f&&(f.status="success"),ie.success({message:`上传${f==null?void 0:f.name}成功`})},u=async()=>{if(a.value.length<=0)return;const s=a.value,f=h.value;if(a.value=[],h.value=[],s.length!==f.length)for(let c=0;c<s.length;c++)s[c].unsubscribe(),s[c]=null;await Le(),r("changed")};return t({open:C}),(s,f)=>(Fe(),Ue("div",Kt,[$(K(Te),{title:b.value,width:400,visible:l.value,"mask-closable":!1,onClose:S},{default:J(()=>[$(K(Oe),{spinning:n.value,class:"upload-inner-box"},{default:J(()=>[$(K(De).Dragger,{ref_key:"uploadRef",ref:i,"file-list":v.value,"onUpdate:fileList":f[0]||(f[0]=c=>v.value=c),class:"upload",drag:"",action:"noaction",multiple:!0,"custom-request":m},{default:J(()=>f[1]||(f[1]=[W("i",{class:"el-icon-upload"},null,-1),W("div",{class:"el-upload__text"},[ze("将文件拖到此处，或"),W("em",null,"点击上传")],-1)])),_:1,__:[1]},8,["file-list"])]),_:1},8,["spinning"])]),_:1},8,["title","visible"])]))}});export{Yt as _};
